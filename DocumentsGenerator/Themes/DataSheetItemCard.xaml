<ResourceDictionary xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
                    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
                    xmlns:controls="clr-namespace:DocumentsGenerator.Controls"
                    xmlns:local="clr-namespace:DocumentsGenerator"
                    xmlns:i="http://schemas.microsoft.com/xaml/behaviors">

    <Style TargetType="ListViewItem" x:Key="DataSheetItemCard">
        <Style.Setters>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ListViewItem">
                        <Grid Background="Transparent"
                              Height="30"
                              MaxHeight="30"
                              Margin="0 0 0 10"
                              Width="600">

                            <Grid.Resources>
                                <Storyboard x:Key="OverlayPulse">
                                    <DoubleAnimationUsingKeyFrames
                                                Storyboard.TargetName="Overlay"
                                                Storyboard.TargetProperty="Opacity">
                                        <EasingDoubleKeyFrame KeyTime="0:0:0.5" Value="1"/>
                                        <EasingDoubleKeyFrame KeyTime="0:0:3.5" Value="1"/>
                                        <EasingDoubleKeyFrame KeyTime="0:0:4" Value="0"/>
                                    </DoubleAnimationUsingKeyFrames>

                                    <ColorAnimationUsingKeyFrames Storyboard.TargetName="TextBox" 
                                                                  Storyboard.TargetProperty="(Border.Background).(SolidColorBrush.Color)">
                                        <LinearColorKeyFrame KeyTime="0:0:0.5" Value="#AC8E4C"/>
                                        <LinearColorKeyFrame KeyTime="0:0:3.5" Value="#AC8E4C"/>
                                        <LinearColorKeyFrame KeyTime="0:0:4" Value="#4B4789"/>
                                    </ColorAnimationUsingKeyFrames>
                                    
                                    <!-- Block clicks only while visible -->
                                    <BooleanAnimationUsingKeyFrames
                                                Storyboard.TargetName="Overlay"
                                                Storyboard.TargetProperty="IsHitTestVisible">
                                        <DiscreteBooleanKeyFrame KeyTime="0:0:0"   Value="True"/>
                                        <DiscreteBooleanKeyFrame KeyTime="0:0:4" Value="False"/>
                                    </BooleanAnimationUsingKeyFrames>
                                </Storyboard>
                            </Grid.Resources>
                            
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="300"/>
                                <ColumnDefinition Width="30"/>
                                <ColumnDefinition Width="35"/>
                            </Grid.ColumnDefinitions>

                            <Border Background="{Binding DataContext.MainColor, RelativeSource={RelativeSource AncestorType=ListView}}">
                                <Label Content="{Binding DisplayKey}"
                                       Foreground="White"
                                       FontWeight="Medium"
                                       FontSize="12"
                                       VerticalAlignment="Center"/>
                            </Border>


                            <Grid Grid.Column="1">
                                <TextBox x:Name="TextBox"
                                         Text="{Binding Value, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                         Background="#4B4789"
                                         Foreground="White"
                                         VerticalContentAlignment="Center"
                                         FontSize="12"
                                         Grid.ColumnSpan="2"
                                         TextWrapping="WrapWithOverflow"
                                         Padding="4 0 34 0"
                                         Visibility="{Binding TextBoxVisibility}"/>

                                <controls:CommitEditableComboBox ItemsSource="{Binding Values}"
                                                                 SelectedItem="{Binding SelectedValue, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                                                 Text="{Binding SelectedValue, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                                                 AddCustomItemToItemsSource="False"
                                                                 Visibility="{Binding ComboBoxVisibility}"
                                                                 Style="{StaticResource CustomComboBox}">
                                    <i:Interaction.Triggers>
                                        <i:EventTrigger EventName="SelectionChanged">
                                            <i:InvokeCommandAction 
                                                Command="{Binding DataContext.SelectionChangedCommand, RelativeSource={RelativeSource AncestorType=ListView}}"
                                                CommandParameter="{Binding}"/>
                                        </i:EventTrigger>
                                    </i:Interaction.Triggers>

                                </controls:CommitEditableComboBox>

                                <Border x:Name="Overlay" Background="Transparent" Opacity="0" Focusable="False" IsHitTestVisible="False"/>

                            </Grid>
                            
                            <controls:IconButton IconImage="/Images/clear-icon.png"
                                              Height="30"
                                              Width="30"
                                              Grid.Column="2"
                                              IconHeight="25"
                                              IconWidth="25"
                                              Background="#88AC4C"
                                              Style="{StaticResource DefaultIconButtonTheme}">
                                <i:Interaction.Triggers>
                                    <i:EventTrigger EventName="Click">
                                        <i:CallMethodAction MethodName="Execute" />
                                        <i:InvokeCommandAction 
                                            Command="{Binding DataContext.ClearValueCommand, RelativeSource={RelativeSource AncestorType=ListView}}"
                                            CommandParameter="{Binding}" />
                                    </i:EventTrigger>
                                </i:Interaction.Triggers>
                            </controls:IconButton>

                            <controls:IconButton IconImage="/Images/info-2-icon.png"
                                                 Height="30"
                                                 Width="30"
                                                 Grid.Column="3"
                                                 IconHeight="25"
                                                 IconWidth="25"
                                                 Background="#88AC4C"
                                                 HorizontalAlignment="Center"
                                                 ToolTipService.InitialShowDelay="100"
                                                 Style="{StaticResource DefaultIconButtonTheme}">
                                <controls:IconButton.ToolTip>
                                    <ToolTip Placement="Center"
                                             VerticalOffset="-40"
                                             Style="{StaticResource CustomToolTipStyle}">
                                        <StackPanel>
                                            <TextBlock Text="Data ostatniej modyfikacji" FontWeight="Bold"/>
                                            <TextBlock Text="{Binding ModificationDate}"/>
                                        </StackPanel>
                                    </ToolTip>
                                </controls:IconButton.ToolTip>
                                
                                <i:Interaction.Triggers>
                                    <i:EventTrigger EventName="Click">
                                        <i:CallMethodAction MethodName="Execute" />
                                        <i:InvokeCommandAction 
                                            Command="{Binding DataContext.ShowInfoCommand, RelativeSource={RelativeSource AncestorType=ListView}}"
                                            CommandParameter="{Binding}" />
                                    </i:EventTrigger>
                                </i:Interaction.Triggers>
                            </controls:IconButton>
                            

                            <i:Interaction.Triggers>
                                <controls:PropertyChangedTrigger Binding="{Binding FeedbackHelperValue}">
                                    <i:ControlStoryboardAction
                                            ControlStoryboardOption="Play"
                                            Storyboard="{StaticResource OverlayPulse}"/>
                                </controls:PropertyChangedTrigger>
                            </i:Interaction.Triggers>

                        </Grid>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style.Setters>
    </Style>
</ResourceDictionary>