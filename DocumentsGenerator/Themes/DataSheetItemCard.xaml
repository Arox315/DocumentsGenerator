<ResourceDictionary xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
                    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
                    xmlns:controls="clr-namespace:DocumentsGenerator.Controls"
                    xmlns:i="http://schemas.microsoft.com/xaml/behaviors"
                    xmlns:ei="http://schemas.microsoft.com/xaml/behaviors">

    <Style TargetType="ListViewItem" x:Key="DataSheetItemCard">
        <Style.Setters>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ListViewItem">
                        <Grid Background="Transparent"
                                    Height="30"
                                    MaxHeight="30"
                                    Margin="0 0 0 10"
                                    Width="600">

                            <Grid.Resources>
                                <Storyboard x:Key="OverlayPulse">
                                    <DoubleAnimationUsingKeyFrames
                                                Storyboard.TargetName="Overlay"
                                                Storyboard.TargetProperty="Opacity">
                                        <EasingDoubleKeyFrame KeyTime="0:0:0.3" Value="1"/>
                                        <EasingDoubleKeyFrame KeyTime="0:0:1.3" Value="1"/>
                                        <EasingDoubleKeyFrame KeyTime="0:0:1.6" Value="0"/>
                                    </DoubleAnimationUsingKeyFrames>

                                    <!-- Optional: block clicks only while visible -->
                                    <BooleanAnimationUsingKeyFrames
                                                Storyboard.TargetName="Overlay"
                                                Storyboard.TargetProperty="IsHitTestVisible">
                                        <DiscreteBooleanKeyFrame KeyTime="0:0:0"   Value="True"/>
                                        <DiscreteBooleanKeyFrame KeyTime="0:0:1.6" Value="False"/>
                                    </BooleanAnimationUsingKeyFrames>
                                </Storyboard>
                            </Grid.Resources>
                            
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="300"/>
                                <ColumnDefinition Width="30"/>
                            </Grid.ColumnDefinitions>

                            <Border Background="{Binding DataContext.MainColor, RelativeSource={RelativeSource AncestorType=ListView}}">
                                <Label Content="{Binding DisplayKey}"
                                       Foreground="White"
                                       FontWeight="Medium"
                                       FontSize="12"
                                       VerticalAlignment="Center"/>
                            </Border>

                            
                            <Grid Grid.Column="1">
                                <TextBox Text="{Binding Value, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                            Background="#4B4789"
                                            Foreground="White"
                                            VerticalContentAlignment="Center"
                                            FontSize="12"
                                            Grid.ColumnSpan="2"
                                            TextWrapping="WrapWithOverflow"
                                            Padding="4 0 34 0"
                                            Visibility="{Binding TextBoxVisibility}"/>

                                <controls:CommitEditableComboBox ItemsSource="{Binding Values}"
                                                                SelectedItem="{Binding SelectedValue, Mode=TwoWay}"
                                                                Text="{Binding SelectedValue, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                                                AddCustomItemToItemsSource="False"
                                                                Visibility="{Binding ComboBoxVisibility}">
                                    <i:Interaction.Triggers>
                                        <i:EventTrigger EventName="SelectionChanged">
                                            <i:InvokeCommandAction 
                                                Command="{Binding DataContext.SelectionChangedCommand, RelativeSource={RelativeSource AncestorType=ListView}}"
                                                CommandParameter="{Binding}"/>
                                        </i:EventTrigger>
                                    </i:Interaction.Triggers>

                                </controls:CommitEditableComboBox>

                                <Border x:Name="Overlay" Background="Black" Opacity="0" Focusable="False" IsHitTestVisible="False"/>

                            </Grid>
                            
                            <controls:IconButton IconImage="/Images/delete-icon.png"
                                              Height="30"
                                              Width="30"
                                              Grid.Column="2"
                                              IconHeight="25"
                                              IconWidth="25"
                                              Background="#88AC4C"
                                              Style="{StaticResource DefaultIconButtonTheme}">
                                <i:Interaction.Triggers>
                                    <i:EventTrigger EventName="Click">
                                        <i:CallMethodAction MethodName="Execute" />
                                        <i:InvokeCommandAction 
                                            Command="{Binding DataContext.ClearValueCommand, RelativeSource={RelativeSource AncestorType=ListView}}"
                                            CommandParameter="{Binding}" />
                                    </i:EventTrigger>
                                </i:Interaction.Triggers>
                            </controls:IconButton>

                            <i:Interaction.Triggers>
                                <controls:PropertyChangedTrigger Binding="{Binding FeedbackHelperValue}">
                                    <ei:ControlStoryboardAction
                                            ControlStoryboardOption="Play"
                                            Storyboard="{StaticResource OverlayPulse}"/>
                                </controls:PropertyChangedTrigger>
                            </i:Interaction.Triggers>

                        </Grid>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style.Setters>
    </Style>
</ResourceDictionary>